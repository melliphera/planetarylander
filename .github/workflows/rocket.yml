name: Rocket (MISRA-Rust) CI

on:
  push:
    paths:
      - 'rocket/**'
      - '.github/workflows/rocket.yml'
  pull_request:
    paths:
      - 'rocket/**'

jobs:
  misra-compliance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt
      
      - name: Check MISRA-Rust lints
        run: cargo clippy --package agc-rocket -- -D warnings
      
      - name: Check documentation
        run: cargo doc --package agc-rocket --no-deps --document-private-items
      
      - name: Verify release error-safety (MISRA-RUST)
        run: |
          cargo clippy --package agc-rocket --release -- \
            -D clippy::panic \
            -D clippy::unwrap_used \
            -D clippy::expect_used \
            -D clippy::indexing_slicing